
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Calico · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../sdn/" />
    
    
    <link rel="prev" href="flannel.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    ABOUT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../k8s-ingress/">
            
                <a href="../k8s-ingress/">
            
                    
                    CONTAINER INGRESS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../k8s-ingress/f5-cis/">
            
                <a href="../k8s-ingress/f5-cis/">
            
                    
                    F5 CIS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../k8s-ingress/f5-cis/install.html">
            
                <a href="../k8s-ingress/f5-cis/install.html">
            
                    
                    安装
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1.1" data-path="../k8s-ingress/f5-cis/solutions/flannel-etcd-mode.html">
            
                <a href="../k8s-ingress/f5-cis/solutions/flannel-etcd-mode.html">
            
                    
                    Flannel etcd mode
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../k8s-ingress/f5-cis/config.html">
            
                <a href="../k8s-ingress/f5-cis/config.html">
            
                    
                    配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../k8s-ingress/f5-cis/as3/">
            
                <a href="../k8s-ingress/f5-cis/as3/">
            
                    
                    AS3
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.3.1" data-path="../k8s-ingress/f5-cis/as3/canary/">
            
                <a href="../k8s-ingress/f5-cis/as3/canary/">
            
                    
                    Canary Releasing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3.2" data-path="../k8s-ingress/f5-cis/as3/ws/">
            
                <a href="../k8s-ingress/f5-cis/as3/ws/">
            
                    
                    WebSocket
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3.3" data-path="../k8s-ingress/f5-cis/as3/hubmode/">
            
                <a href="../k8s-ingress/f5-cis/as3/hubmode/">
            
                    
                    HubMode
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="../k8s-ingress/f5-cis/ingress/">
            
                <a href="../k8s-ingress/f5-cis/ingress/">
            
                    
                    Ingress
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5" data-path="../k8s-ingress/f5-cis/cccl/">
            
                <a href="../k8s-ingress/f5-cis/cccl/">
            
                    
                    CCCL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.6" data-path="../k8s-ingress/f5-cis/mgmt-isolation/">
            
                <a href="../k8s-ingress/f5-cis/mgmt-isolation/">
            
                    
                    管理隔离
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../k8s-ingress/nginx-ingress/">
            
                <a href="../k8s-ingress/nginx-ingress/">
            
                    
                    NGINX
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../k8s-ingress/nginx-ingress/bigip/">
            
                <a href="../k8s-ingress/nginx-ingress/bigip/">
            
                    
                    Deployment Architectures
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../k8s-ingress/nginx-plus-ingress/">
            
                <a href="../k8s-ingress/nginx-plus-ingress/">
            
                    
                    NGINX PLUS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../k8s-ingress/nginx-plus-ingress/monitor/dashboard.html">
            
                <a href="../k8s-ingress/nginx-plus-ingress/monitor/dashboard.html">
            
                    
                    Monitor Dashboard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../k8s-ingress/nginx-plus-ingress/bigip/">
            
                <a href="../k8s-ingress/nginx-plus-ingress/bigip/">
            
                    
                    Deployment Architectures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../k8s-ingress/nginx-plus-ingress/l4-lb/">
            
                <a href="../k8s-ingress/nginx-plus-ingress/l4-lb/">
            
                    
                    L4 Load Balancing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="../k8s-ingress/nginx-plus-ingress/health-checks/">
            
                <a href="../k8s-ingress/nginx-plus-ingress/health-checks/">
            
                    
                    Active Health Checks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="../k8s-ingress/nginx-plus-ingress/release/">
            
                <a href="../k8s-ingress/nginx-plus-ingress/release/">
            
                    
                    Zero-Downtime Releases
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../k8s-ingress/performance/">
            
                <a href="../k8s-ingress/performance/">
            
                    
                    PERFORMANCE
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="./">
            
                <a href="./">
            
                    
                    CONTAINER NETWORK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="docker.html">
            
                <a href="docker.html">
            
                    
                    DOCKER
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="k8s.html">
            
                <a href="k8s.html">
            
                    
                    K8S
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="kubenet.html">
            
                <a href="kubenet.html">
            
                    
                    kubenet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="flannel.html">
            
                <a href="flannel.html">
            
                    
                    Flannel
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.2.3" data-path="Calico.html">
            
                <a href="Calico.html">
            
                    
                    Calico
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../sdn/">
            
                <a href="../sdn/">
            
                    
                    SDN
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../sdn/mininet.html">
            
                <a href="../sdn/mininet.html">
            
                    
                    Mininet
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../nginx/">
            
                <a href="../nginx/">
            
                    
                    NGINX
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../nginx/concepts.html">
            
                <a href="../nginx/concepts.html">
            
                    
                    入门到精通
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../nginx/install.html">
            
                <a href="../nginx/install.html">
            
                    
                    离线安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../nginx/controller.html">
            
                <a href="../nginx/controller.html">
            
                    
                    Nginx Controller
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="../nginx/apidrive.html">
            
                <a href="../nginx/apidrive.html">
            
                    
                    API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../nginx/usecase.html">
            
                <a href="../nginx/usecase.html">
            
                    
                    Use Case
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.4.1" data-path="../nginx/docker.html">
            
                <a href="../nginx/docker.html">
            
                    
                    Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../nginx/app/">
            
                <a href="../nginx/app/">
            
                    
                    现代应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../nginx/programming.html">
            
                <a href="../nginx/programming.html">
            
                    
                    可编程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../dist.html">
            
                <a href="../dist.html">
            
                    
                    DISTRIBUTED
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../zk/">
            
                <a href="../zk/">
            
                    
                    ZooKeeper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" >
            
                <a target="_blank" href="https://cloudadc.github.io/distribute-dev-framework/content/dubbo">
            
                    
                    DUBBO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../mongo/">
            
                <a href="../mongo/">
            
                    
                    MongoDB
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.1" data-path="../mongo/viewpoint/presentation.html">
            
                <a href="../mongo/viewpoint/presentation.html">
            
                    
                    定位
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.1.1" data-path="../mongo/viewpoint/5thingsfornosql.html">
            
                <a href="../mongo/viewpoint/5thingsfornosql.html">
            
                    
                    NOSQL 选择五维度
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.1.2" data-path="../mongo/viewpoint/oversea.html">
            
                <a href="../mongo/viewpoint/oversea.html">
            
                    
                    MongoDB 助力企业出海
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.1.3" data-path="../mongo/viewpoint/td.html">
            
                <a href="../mongo/viewpoint/td.html">
            
                    
                    Teradata 优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.1.4" data-path="../mongo/viewpoint/cards.html">
            
                <a href="../mongo/viewpoint/cards.html">
            
                    
                    MongoDB 对话卡片
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3.2" data-path="../mongo/dba/basic.html">
            
                <a href="../mongo/dba/basic.html">
            
                    
                    基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.3" data-path="../mongo/dev/">
            
                <a href="../mongo/dev/">
            
                    
                    开发
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.3.1" data-path="../mongo/dev/aggregation.html">
            
                <a href="../mongo/dev/aggregation.html">
            
                    
                    Aggregation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.3.2" data-path="../mongo/dev/aggregation-sum.html">
            
                <a href="../mongo/dev/aggregation-sum.html">
            
                    
                    $sum
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.3.3" data-path="../mongo/dev/transactions.html">
            
                <a href="../mongo/dev/transactions.html">
            
                    
                    分布式事务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.3.4" data-path="../mongo/dev/java.html">
            
                <a href="../mongo/dev/java.html">
            
                    
                    Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.3.5" data-path="../mongo/dev/geo.html">
            
                <a href="../mongo/dev/geo.html">
            
                    
                    地理信息
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3.4" data-path="../mongo/dba/cluster-admin.html">
            
                <a href="../mongo/dba/cluster-admin.html">
            
                    
                    运维
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.4.1" data-path="../mongo/dba/replication.html">
            
                <a href="../mongo/dba/replication.html">
            
                    
                    高可用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4.2" data-path="../mongo/dba/rs-deployments.html">
            
                <a href="../mongo/dba/rs-deployments.html">
            
                    
                    部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4.3" data-path="../mongo/dba/rs-maintenance.html">
            
                <a href="../mongo/dba/rs-maintenance.html">
            
                    
                    维护
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4.4" data-path="../mongo/dba/sharding.html">
            
                <a href="../mongo/dba/sharding.html">
            
                    
                    分片
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4.5" data-path="../mongo/dba/dba.html">
            
                <a href="../mongo/dba/dba.html">
            
                    
                    DBA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4.6" data-path="../mongo/dba/sh-restore.html">
            
                <a href="../mongo/dba/sh-restore.html">
            
                    
                    基于 Delayed Secondary 时间点恢复
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4.7" data-path="../mongo/dba/opsmanager.html">
            
                <a href="../mongo/dba/opsmanager.html">
            
                    
                    Ops Manager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4.8" data-path="../mongo/dba/perf.html">
            
                <a href="../mongo/dba/perf.html">
            
                    
                    性能调优
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4.9" data-path="../mongo/dba/troubleshooting.html">
            
                <a href="../mongo/dba/troubleshooting.html">
            
                    
                    监控
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3.5" data-path="../mongo/dba/security.html">
            
                <a href="../mongo/dba/security.html">
            
                    
                    安全
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../kafka/">
            
                <a href="../kafka/">
            
                    
                    Kafka
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.4.1" data-path="../kafka/installing/">
            
                <a href="../kafka/installing/">
            
                    
                    安装
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../elastic/">
            
                <a href="../elastic/">
            
                    
                    ElasticSearch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../spark/">
            
                <a href="../spark/">
            
                    
                    Spark
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <a target="_blank" href="https://cloudadc.github.io/nodejs-honeypot/">
            
                    
                    NODE.JS HONEYPOT
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Calico</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="calico">Calico</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#__">&#x5B89;&#x88C5;</a>
<ul class="sectlevel2">
<li><a href="#_install_via_operator">Install via operator</a></li>
<li><a href="#_install_via_manifest">Install via Manifest</a></li>
<li><a href="#_install_calicoctl">Install calicoctl</a></li>
<li><a href="#_deploy_yaobank_app">Deploy YaoBank App</a></li>
</ul>
</li>
<li><a href="#___2">&#x5B89;&#x5168;</a>
<ul class="sectlevel2">
<li><a href="#__network_policy">&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981; Network Policy&#xFF1F;</a></li>
<li><a href="#_kubernetes_network_policy_calico_network_policy">Kubernetes Network Policy &#x4E0E; Calico &#x989D;&#x5916;&#x589E;&#x52A0;&#x7684; Network Policy</a></li>
<li><a href="#__pod">&#x5141;&#x8BB8;&#x6765;&#x81EA;&#x7279;&#x5B9A;POD&#x7684;&#x5165;&#x5411;&#x8BBF;&#x95EE;</a></li>
<li><a href="#__default_deny">&#x8BBE;&#x7F6E; Default Deny &#x7B56;&#x7565;</a></li>
<li><a href="#_yaobank">yaobank &#x7B56;&#x7565;&#x63A7;&#x5236;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;</a></li>
<li><a href="#_calico_yaobank">Calico &#x7B56;&#x7565;&#x8BBE;&#x5B9A; yaobank &#x7B56;&#x7565;&#x63A7;&#x5236;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;</a></li>
<li><a href="#_managing_trust_across_teams">Managing Trust Across Teams</a></li>
<li><a href="#_network_policy_for_hosts_and_nodeports">Network Policy for Hosts and NodePorts</a></li>
</ul>
</li>
<li><a href="#_pod_connectivity">POD Connectivity</a>
<ul class="sectlevel2">
<li><a href="#_pods_network">Pods Network</a></li>
<li><a href="#_wireguard_encryption">WireGuard Encryption</a></li>
<li><a href="#_ip_pools">IP Pools</a></li>
<li><a href="#_bgp_peering">BGP Peering</a></li>
<li><a href="#_cluster_ip_address_ranges">Cluster IP Address Ranges</a></li>
<li><a href="#_create_ip_pools">Create IP Pools</a></li>
</ul>
</li>
<li><a href="#_kubernetes_services_networking">Kubernetes Services Networking</a>
<ul class="sectlevel2">
<li><a href="#_kube_proxy_service_debug">kube-proxy service debug</a></li>
<li><a href="#_calico_native_service_handling">Calico Native Service Handling</a></li>
<li><a href="#_advertising_services">Advertising Services</a></li>
</ul>
</li>
<li><a href="#_kubernetes_networking_with_aws">Kubernetes Networking with AWS</a>
<ul class="sectlevel2">
<li><a href="#_aws_networking">AWS Networking</a></li>
<li><a href="#_aws_cni">AWS-CNI &#x4F18;&#x7F3A;&#x70B9;</a></li>
<li><a href="#_kops">KOps</a></li>
<li><a href="#_todo">TODO</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="__">&#x5B89;&#x88C5;</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_install_via_operator">Install via operator</h3>
<div class="listingblock">
<div class="title"><strong>1. install the operator</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create <span class="hljs-_">-f</span> https://docs.projectcalico.org/archive/v3.16/manifests/tigera-operator.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. Install Calico</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | kubectl apply <span class="hljs-_">-f</span> -
apiVersion: operator.tigera.io/v1
kind: Installation
metadata:
  name: default
spec:
  calicoNetwork:
    containerIPForwarding: Enabled
    ipPools:
    - cidr: 198.19.16.0/21
      natOutgoing: Enabled
      encapsulation: None
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. Calico pods</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl get pods -n calico-system
NAME                                       READY   STATUS    RESTARTS   AGE
calico-typha-7fb7f4bd66-fvt89              1/1     Running   2          28m
calico-typha-7fb7f4bd66-gltp8              1/1     Running   2          28m
calico-node-42d6k                          1/1     Running   1          28m
calico-typha-7fb7f4bd66-lq6b5              1/1     Running   2          28m
calico-node-tlvbb                          1/1     Running   2          28m
calico-kube-controllers-57f767d97b-nxrnx   1/1     Running   3          28m
calico-node<span class="hljs-_">-l</span>5n4s                          1/1     Running   0          28m</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>calico-node</strong>: Calico-node runs on every Kubernetes cluster node as a DaemonSet. It is responsible for enforcing network policy, setting up routes on the nodes, plus managing any virtual interfaces for IPIP, VXLAN, or WireGuard.</p>
</li>
<li>
<p><strong>calico-typha</strong>: Typha is as a stateful proxy for the Kubernetes API server. It&#x2019;s used by every calico-node pod to query and watch Kubernetes resources without putting excessive load on the Kubernetes API server.  The Tigera Operator automatically scales the number of Typha instances as the cluster size grows.</p>
</li>
<li>
<p><strong>calico-kube-controllers</strong>: Runs a variety of Calico specific controllers that automate synchronization of resources. For example, when a Kubernetes node is deleted, it tidies up any IP addresses or other Calico resources associated with the node.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Kubernetes network model does specify that pods can communicate with each other directly without NAT. But a pod communicating with another pod via a service is not direct communication, and normally will use NAT to change the connection destination from the service to the backing pod as part of load balancing.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_install_via_manifest">Install via Manifest</h3>
<div class="listingblock">
<div class="title"><strong>1. Download Manifest</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl https://docs.projectcalico.org/manifests/calico.yaml -O</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Uncomment the <code>CALICO_IPV4POOL_CIDR</code>, and make sure the CIDR value equals the value of <code>--pod-network-cidr</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><strong>2. Install Calico</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl apply <span class="hljs-_">-f</span> calico.yaml</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Refer to <a href="https://docs.projectcalico.org/getting-started/kubernetes/self-managed-onprem/onpremises" target="_blank">LINK</a> for more details.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><strong>3. Calico pods</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl get pods -A | grep calico
kube-system   calico-kube-controllers-855445d444-8rx26   1/1     Running   2          38h
kube-system   calico-node-56d8l                          1/1     Running   2          38h
kube-system   calico-node-r7ltw                          1/1     Running   2          38h</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Install via Manifest doesn&#x2019;t contains the <strong>calico-typha</strong>, which has less performance comapre with Install via operator.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_install_calicoctl">Install calicoctl</h3>
<div class="listingblock">
<div class="title"><strong>1. Download</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl -o calicoctl -O -L  <span class="hljs-string">&quot;https://github.com/projectcalico/calicoctl/releases/download/v3.20.1/calicoctl&quot;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. Copy to /usr/local/bin</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">chmod +x calicoctl
sudo cp calicoctl /usr/<span class="hljs-built_in">local</span>/bin/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. Verify</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ calicoctl get nodes -o wide
NAME            ASN       IPV4             IPV6
control-plane   (64512)   172.16.25.3/24
worker01        (64512)   172.16.25.4/24</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Refer to <a href="https://docs.projectcalico.org/reference/calicoctl/" class="bare" target="_blank">https://docs.projectcalico.org/reference/calicoctl/</a> for calicoctl reference.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_yaobank_app">Deploy YaoBank App</h3>
<div class="paragraph">
<p>The YaoBank Demo App contains 3 Microservice:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="files/microservice-on-k8s.png" alt="microservice on k8s.png"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Customer (which provides a simple web GUI)</p>
</li>
<li>
<p>Summary (some middleware business logic)</p>
</li>
<li>
<p>Database (the persistent datastore for the bank)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Originally from <a href="https://raw.githubusercontent.com/tigera/ccol1/main/yaobank.yaml" class="bare" target="_blank">https://raw.githubusercontent.com/tigera/ccol1/main/yaobank.yaml</a>, the nodeSelector are adjuested, and the docker image are retagged.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="files/yaobank.yaml">yaobank.yaml</a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><strong>1. Deploy YaoBank App</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl apply <span class="hljs-_">-f</span> yaobank.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. Show YaoBank App</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl get pods -n yaobank --show-labels --no-headers
customer-cfc847564-dk56j    1/1   Running   0     82s   app=customer,pod-template-hash=cfc847564,version=v1
database-644f4569dd-mnncp   1/1   Running   0     83s   app=database,pod-template-hash=644f4569dd,version=v1
summary-5877cf8b57-9sc44    1/1   Running   0     82s   app=summary,pod-template-hash=5877cf8b57,version=v1
summary-5877cf8b57-kjb7b    1/1   Running   0     82s   app=summary,pod-template-hash=5877cf8b57,version=v1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. Verify App</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl http://control-plane:30180/ -I
HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 593
Server: Werkzeug/0.12.2 Python/2.7.12
Date: Fri, 24 Sep 2021 16:59:18 GMT</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="___2">&#x5B89;&#x5168;</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__network_policy">&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981; Network Policy&#xFF1F;</h3>
<div class="paragraph">
<p><span class="image"><img src="files/networkpolicy.png" alt="networkpolicy.png"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#x5728;&#x5BB9;&#x5668;&#x5E73;&#x53F0;&#x9700;&#x8981;&#x57FA;&#x4E8E;IP&#x5730;&#x5740;&#x6216;&#x8005;&#x5E94;&#x7528;&#x7AEF;&#x53E3;&#x8FDB;&#x884C;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#xFF08;OSI L3&#x3001;L4&#xFF09;</p>
</li>
<li>
<p>&#x4EE5;&#x5E94;&#x7528;&#x4E3A;&#x4E2D;&#x5FC3;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x901A;&#x8FC7;&#x6807;&#x7B7E;&#x5339;&#x914D;&#x7684;&#x65B9;&#x5F0F;&#x63A7;&#x5236;&#x7740;&#x5E94;&#x7528;POD&#x5982;&#x4F55;&#x88AB;&#x8BBF;&#x95EE;</p>
</li>
<li>
<p>K8S &#x63D0;&#x4F9B;&#x4E86; Network Policy API &#x63A5;&#x53E3;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x505A;&#x5B9E;&#x73B0;&#xFF0C;&#x5B9E;&#x73B0;&#x4EA4;&#x7ED9; CNI &#x63D2;&#x4EF6;&#x5B9E;&#x73B0;&#x5382;&#x5546;&#xFF0C;&#x5B9E;&#x73B0;&#x4E0E;&#x5E95;&#x5C42;&#x7F51;&#x7EDC;&#x80FD;&#x529B;&#x7684;&#x89E3;&#x8026;</p>
</li>
<li>
<p>Network Policy&#x4EF7;&#x503C;</p>
<div class="ulist">
<ul>
<li>
<p>&#x653B;&#x51FB;&#x8005;&#x82B1;&#x6837;&#x66F4;&#x52A0;&#x806A;&#x660E;</p>
</li>
<li>
<p>&#x653B;&#x51FB;&#x91CF;&#x66F4;&#x591A;</p>
</li>
<li>
<p>&#x4E1C;&#x897F;&#x5411;&#x5B89;&#x5168;</p>
</li>
<li>
<p>&#x53EF;&#x4EE5;&#x8BA9;&#x975E;&#x7F51;&#x7EDC;&#x4E13;&#x5BB6;&#x914D;&#x7F6E;&#x9632;&#x706B;&#x5899;&#x3002;</p>
</li>
</ul>
</div>
</li>
<li>
<p>&#x5357;&#x5317;&#x5411;&#x5B89;&#x5168;&#xFF1A;Calico Enterprise integrates with Fortinet firewalls, and make Fortinet understands ingress node or pod ip address.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kubernetes_network_policy_calico_network_policy">Kubernetes Network Policy &#x4E0E; Calico &#x989D;&#x5916;&#x589E;&#x52A0;&#x7684; Network Policy</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Kubernetes Network Policy</th>
<th class="tableblock halign-left valign-top">Calico Network Policy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Ingress &amp; egress rules</p>
</li>
<li>
<p>Pod selectors</p>
</li>
<li>
<p>Namespce selectors</p>
</li>
<li>
<p>Port lists</p>
</li>
<li>
<p>Named Ports</p>
</li>
<li>
<p>IP blocks &amp; excepts</p>
</li>
<li>
<p>TCP, UDP, or SCTP</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Namespaced &amp; global scopes</p>
</li>
<li>
<p>Deny and log actions</p>
</li>
<li>
<p>Policy ordering</p>
</li>
<li>
<p>Richer matches, like ServiceAccounts, ICMP</p>
</li>
<li>
<p>Istio integration, like Cryptpgraphic identity matching, Layer 5-7 match criteria</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="__pod">&#x5141;&#x8BB8;&#x6765;&#x81EA;&#x7279;&#x5B9A;POD&#x7684;&#x5165;&#x5411;&#x8BBF;&#x95EE;</h3>
<div class="paragraph">
<p>&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x4E3A;&#x5141;&#x8BB8;&#x6765;&#x81EA;&#x7279;&#x5B9A;POD&#x7684;&#x5165;&#x5411;&#x8BBF;&#x95EE;&#xFF0C;&#x540D;&#x79F0;&#x4E3A;database&#x7684;POD&#x53EA;&#x5141;&#x8BB8;&#x6765;&#x81EA;summary POD&#x7684;&#x5165;&#x5411;&#x8BBF;&#x95EE;</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="files/allow-traffic-from-specific-pod.png" alt="allow traffic from specific pod.png"></span></p>
</div>
<div class="listingblock">
<div class="title"><strong>1. &#x67E5;&#x770B; database POD &#x6807;&#x7B7E;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl get pods -n yaobank --show-labels | grep database
database-644f4569dd-mnncp   1/1     Running   0          22h   app=database,pod-template-hash=644f4569dd,version=v1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x67E5;&#x770B; summary POD &#x6807;&#x7B7E;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl get pods -n yaobank --show-labels | grep summary
summary-5877cf8b57-9sc44    1/1     Running   0          22h   app=summary,pod-template-hash=5877cf8b57,version=v1
summary-5877cf8b57-kjb7b    1/1     Running   0          22h   app=summary,pod-template-hash=5877cf8b57,version=v1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x5206;&#x522B;&#x5728; customer POD &#x548C;summary POD &#x5185;&#x8BBF;&#x95EE;database</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">CUSTOMER_POD=$(kubectl get pods -n yaobank <span class="hljs-_">-l</span> app=customer -o name)
SUMMARY_POD=$(kubectl get pods -n yaobank <span class="hljs-_">-l</span> app=summary -o name | head -n 1)

$ kubectl <span class="hljs-built_in">exec</span> -it <span class="hljs-variable">$CUSTOMER_POD</span> -n yaobank -- bash
root@customer-cfc847564-dk56j:/app<span class="hljs-comment"># curl http://database:2379/v2/keys?recursive=true -I -s | head -n 1</span>
HTTP/1.1 200 OK

$ kubectl <span class="hljs-built_in">exec</span> -it <span class="hljs-variable">$SUMMARY_POD</span> -n yaobank -- bash
root@summary-5877cf8b57-9sc44:/app<span class="hljs-comment"># curl http://database:2379/v2/keys?recursive=true -I -s | head -n 1</span>
HTTP/1.1 200 OK</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x6DFB;&#x52A0; database-policy</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | kubectl apply <span class="hljs-_">-f</span> -
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: database-policy
  namespace: yaobank
spec:
  podSelector:
    matchLabels:
      app: database
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: summary
    ports:
      - protocol: TCP
        port: 2379
  egress:
    - to: []
EOF</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spec.podSelector.matchLabels</code> - &#x6307;&#x5B9A;&#x8981;&#x4FDD;&#x62A4;&#x7684;&#x76EE;&#x6807; POD &#x4E3A; database&#xFF0C;&#x5177;&#x6709; <code>app=database</code> &#x7684;&#x6807;&#x7B7E;&#x3002;</p>
</li>
<li>
<p><code>spec.ingress.from.podSelector.matchLabels</code> - &#x6307;&#x5B9A;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;&#x7684; POD &#x9700;&#x5177;&#x6709; <code>app=summary</code> &#x6807;&#x7B7E;</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><strong>5. &#x91CD;&#x590D;&#x6267;&#x884C;&#x7B2C;3&#x6B65;&#xFF0C;&#x5206;&#x522B;&#x5728; customer POD &#x548C;summary POD &#x5185;&#x8BBF;&#x95EE;database</strong>*</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">root@customer-cfc847564-dk56j:/app<span class="hljs-comment"># curl http://database:2379/v2/keys?recursive=true -I -m 3</span>
curl: (28) Connection timed out after 3001 milliseconds

$ kubectl <span class="hljs-built_in">exec</span> -it <span class="hljs-variable">$SUMMARY_POD</span> -n yaobank -- bash
root@summary-5877cf8b57-9sc44:/app<span class="hljs-comment"># curl http://database:2379/v2/keys?recursive=true -I -s | head -n 1</span>
HTTP/1.1 200 OK</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
&#x5BF9;&#x6BD4;&#x7B2C;&#x4E09;&#x6B65;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x62D2;&#x7EDD;&#x6765;&#x81EA; customer POD &#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x800C;&#x5141;&#x8BB8;&#x6765;&#x81EA; summary POD &#x7684;&#x8BF7;&#x6C42;&#x3002;
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><strong>6. Clean Up</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl delete networkpolicy database-policy -n yaobank</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__default_deny">&#x8BBE;&#x7F6E; Default Deny &#x7B56;&#x7565;</h3>
<div class="listingblock">
<div class="title"><strong>1. &#x8BBF;&#x95EE;&#x670D;&#x52A1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl http://control-plane:30180 -m 3
  &lt;body&gt;
  	&lt;h1&gt;Welcome to YAO Bank&lt;/h1&gt;
  	&lt;h2&gt;Name: Spike Curtis&lt;/h2&gt;
  	&lt;h2&gt;Balance: 2389.45&lt;/h2&gt;
  	&lt;p&gt;&lt;a href=<span class="hljs-string">&quot;/logout&quot;</span>&gt;Log Out &gt;&gt;&lt;/a&gt;&lt;/p&gt;
  &lt;/body&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x8BBE;&#x7F6E; Default Deny &#x7B56;&#x7565;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | kubectl apply <span class="hljs-_">-f</span> -
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny
  namespace: yaobank
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x91CD;&#x590D;&#x6B65;&#x9AA4; 1&#xFF0C;&#x8BBF;&#x95EE;&#x670D;&#x52A1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl http://control-plane:30180 -m 3
curl: (28) Operation timed out after 3001 milliseconds with 0 bytes received</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x5206;&#x522B;&#x5728; customer POD &#x548C; summary POD &#x4E2D;&#x8BBF;&#x95EE;&#x5176;&#x4ED6; POD</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl <span class="hljs-built_in">exec</span> -it <span class="hljs-variable">$CUSTOMER_POD</span> -n yaobank -- bash
root@customer-cfc847564-dk56j:/app<span class="hljs-comment"># curl http://summary -m 3</span>
curl: (28) Resolving timed out after 3513 milliseconds
root@customer-cfc847564-dk56j:/app<span class="hljs-comment"># curl http://database:2379/v2/keys?recursive=true -m 3</span>
curl: (28) Resolving timed out after 3512 milliseconds

$ kubectl <span class="hljs-built_in">exec</span> -it <span class="hljs-variable">$SUMMARY_POD</span> -n yaobank -- bash
root@summary-5877cf8b57-9sc44:/app<span class="hljs-comment"># curl http://database:2379/v2/keys?recursive=true -m 3</span>
curl: (28) Resolving timed out after 3515 milliseconds</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. Clean UP</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl delete networkpolicy default-deny -n yaobank</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_yaobank">yaobank &#x7B56;&#x7565;&#x63A7;&#x5236;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;</h3>
<div class="listingblock">
<div class="title"><strong>1. &#x8BBE;&#x7F6E; Default Deny &#x7B56;&#x7565;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | kubectl apply <span class="hljs-_">-f</span> -
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny
  namespace: yaobank
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#x57FA;&#x4E8E; namespace &#x8BBE;&#x7F6E; Default Deny &#x7B56;&#x7565;&#xFF0C;namespace &#x5185;&#x6240;&#x6709; POD &#x51FA;&#x5411;&#x548C;&#x5165;&#x5411;&#x90FD;&#x88AB;&#x7981;&#x6B62;&#xFF1A;</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="files/np-default-deny.png" alt="np default deny.png"></span></p>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x57FA;&#x4E8E;&#x6240;&#x6709; POD &#x8BBE;&#x5B9A;&#x5165;&#x5411;&#x548C;&#x51FA;&#x5411;&#x7B56;&#x7565;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | kubectl apply <span class="hljs-_">-f</span> -
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: customer-policy
  namespace: yaobank
spec:
  podSelector:
    matchLabels:
      app: customer
  ingress:
    - ports:
      - protocol: TCP
        port: 80
  egress:
    - to: []
---
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: summary-policy
  namespace: yaobank
spec:
  podSelector:
    matchLabels:
      app: summary
  ingress:
    - from:
      - podSelector:
          matchLabels:
            app: customer
      ports:
      - protocol: TCP
        port: 80
  egress:
    - to:
      - podSelector:
          matchLabels:
            app: database
      ports:
      - protocol: TCP
        port: 2379
---
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: database-policy
  namespace: yaobank
spec:
  podSelector:
    matchLabels:
      app: database
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: summary
    ports:
      - protocol: TCP
        port: 2379
  egress:
    - to: []
EOF</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_calico_yaobank">Calico &#x7B56;&#x7565;&#x8BBE;&#x5B9A; yaobank &#x7B56;&#x7565;&#x63A7;&#x5236;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;</h3>
<div class="paragraph">
<p>Kubernetes &#x5B9A;&#x4E49;&#x7684; Default Deny &#x53EA;&#x80FD;&#x57FA;&#x4E8E;&#x5355;&#x4E2A; namespace &#x8BBE;&#x5B9A;Default Deny&#xFF0C;&#x800C; Calico &#x7B56;&#x7565;&#x8BBE;&#x5B9A; Default Deny &#x662F;&#x57FA;&#x4E8E; Kubernetes &#x5168;&#x5C40;&#x8BBE;&#x5B9A;&#x3002;</p>
</div>
<div class="listingblock">
<div class="title"><strong>1. Default Deny</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | calicoctl apply <span class="hljs-_">-f</span> -
apiVersion: projectcalico.org/v3
kind: GlobalNetworkPolicy
metadata:
  name: default-app-policy
spec:
  namespaceSelector: has(projectcalico.org/name) &amp;&amp; projectcalico.org/name not <span class="hljs-keyword">in</span> {<span class="hljs-string">&quot;kube-system&quot;</span>, <span class="hljs-string">&quot;calico-system&quot;</span>}
  types:
  - Ingress
  - Egress
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x66F4;&#x65B0;&#x5168;&#x5C40;&#x7B56;&#x7565;&#xFF0C;&#x5141;&#x8BB8; DNS</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | calicoctl apply <span class="hljs-_">-f</span> -
apiVersion: projectcalico.org/v3
kind: GlobalNetworkPolicy
metadata:
  name: default-app-policy
spec:
  namespaceSelector: has(projectcalico.org/name) &amp;&amp; projectcalico.org/name not <span class="hljs-keyword">in</span> {<span class="hljs-string">&quot;kube-system&quot;</span>, <span class="hljs-string">&quot;calico-system&quot;</span>}
  types:
  - Ingress
  - Egress
  egress:
    - action: Allow
      protocol: UDP
      destination:
        selector: k8s-app == <span class="hljs-string">&quot;kube-dns&quot;</span>
        ports:
          - 53
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x57FA;&#x4E8E;&#x6BCF;&#x4E2A; POD &#x8BBE;&#x5B9A;&#x51FA;&#x5165;&#x5411;&#x7B56;&#x7565;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | kubectl apply <span class="hljs-_">-f</span> -
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: database-policy
  namespace: yaobank
spec:
  podSelector:
    matchLabels:
      app: database
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: summary
    ports:
      - protocol: TCP
        port: 2379
  egress:
    - to: []
---
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: customer-policy
  namespace: yaobank
spec:
  podSelector:
    matchLabels:
      app: customer
  ingress:
    - ports:
      - protocol: TCP
        port: 80
  egress:
    - to: []
---
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: summary-policy
  namespace: yaobank
spec:
  podSelector:
    matchLabels:
      app: summary
  ingress:
    - from:
      - podSelector:
          matchLabels:
            app: customer
      ports:
      - protocol: TCP
        port: 80
  egress:
    - to:
      - podSelector:
          matchLabels:
            app: database
      ports:
      - protocol: TCP
        port: 2379
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x67E5;&#x770B;&#x7B56;&#x7565;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ calicoctl get GlobalNetworkPolicy
NAME
default-app-policy

$ kubectl get NetworkPolicy -n yaobank
NAME              POD-SELECTOR   AGE
customer-policy   app=customer   4m16s
database-policy   app=database   4m15s
summary-policy    app=summary    4m15s</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. &#x8BBF;&#x95EE;&#x670D;&#x52A1;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl http://control-plane:30180 -I <span class="hljs-_">-s</span> | head -n 1
HTTP/1.0 200 OK</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. Clean Up</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl delete NetworkPolicy summary-policy -n yaobank
kubectl delete NetworkPolicy customer-policy -n yaobank
kubectl delete NetworkPolicy database-policy -n yaobank

calicoctl delete GlobalNetworkPolicy default-app-policy</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_managing_trust_across_teams">Managing Trust Across Teams</h3>
<div class="listingblock">
<div class="title"><strong>1. Lockdown Cluster Egress</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | calicoctl apply <span class="hljs-_">-f</span> -
apiVersion: projectcalico.org/v3
kind: GlobalNetworkPolicy
metadata:
  name: egress-lockdown
spec:
  order: 600
  namespaceSelector: has(projectcalico.org/name) &amp;&amp; projectcalico.org/name not <span class="hljs-keyword">in</span> {<span class="hljs-string">&quot;kube-system&quot;</span>, <span class="hljs-string">&quot;calico-system&quot;</span>}
  serviceAccountSelector: internet-egress not <span class="hljs-keyword">in</span> {<span class="hljs-string">&quot;allowed&quot;</span>}
  types:
  - Egress
  egress:
    - action: Deny
      destination:
        notNets:
          - 10.0.0.0/8
          - 172.16.0.0/12
          - 192.168.0.0/16
          - 198.18.0.0/15
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. Grant Selective Cluster Egress</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl label serviceaccount -n yaobank customer internet-egress=allowed</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. Clean Up</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">calicoctl delete GlobalNetworkPolicy egress-lockdown</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_network_policy_for_hosts_and_nodeports">Network Policy for Hosts and NodePorts</h3>
<div class="listingblock">
<div class="title"><strong>1. Network Policy for Nodes</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF| calicoctl apply <span class="hljs-_">-f</span> -
---
apiVersion: projectcalico.org/v3
kind: GlobalNetworkPolicy
metadata:
  name: default-node-policy
spec:
  selector: has(kubernetes.io/hostname)
  ingress:
  - action: Allow
    protocol: TCP
    <span class="hljs-built_in">source</span>:
      nets:
      - 127.0.0.1/32
  - action: Allow
    protocol: UDP
    <span class="hljs-built_in">source</span>:
      nets:
      - 127.0.0.1/32
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. Create Host Endpoints</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">calicoctl patch kubecontrollersconfiguration default --patch=<span class="hljs-string">&apos;{&quot;spec&quot;: {&quot;controllers&quot;: {&quot;node&quot;: {&quot;hostEndpoint&quot;: {&quot;autoCreate&quot;: &quot;Enabled&quot;}}}}}&apos;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. Restrict Access to Kubernetes NodePorts</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | calicoctl apply <span class="hljs-_">-f</span> -
---
apiVersion: projectcalico.org/v3
kind: GlobalNetworkPolicy
metadata:
  name: nodeport-policy
spec:
  order: 100
  selector: has(kubernetes.io/hostname)
  applyOnForward: <span class="hljs-literal">true</span>
  preDNAT: <span class="hljs-literal">true</span>
  ingress:
  - action: Deny
    protocol: TCP
    destination:
      ports: [<span class="hljs-string">&quot;30000:32767&quot;</span>]
  - action: Deny
    protocol: UDP
    destination:
      ports: [<span class="hljs-string">&quot;30000:32767&quot;</span>]
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. Selectively allow access to customer front end</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | calicoctl apply <span class="hljs-_">-f</span> -
---
apiVersion: projectcalico.org/v3
kind: GlobalNetworkPolicy
metadata:
  name: nodeport-policy
spec:
  order: 100
  selector: has(kubernetes.io/hostname)
  applyOnForward: <span class="hljs-literal">true</span>
  preDNAT: <span class="hljs-literal">true</span>
  ingress:
  - action: Allow
    protocol: TCP
    destination:
      ports: [30180]
    <span class="hljs-built_in">source</span>:
      nets:
      - 198.19.15.254/32
  - action: Deny
    protocol: TCP
    destination:
      ports: [<span class="hljs-string">&quot;30000:32767&quot;</span>]
  - action: Deny
    protocol: UDP
    destination:
      ports: [<span class="hljs-string">&quot;30000:32767&quot;</span>]
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. Clean Up</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">calicoctl delete GlobalNetworkPolicy default-node-policy
calicoctl delete GlobalNetworkPolicy nodeport-policy</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pod_connectivity">POD Connectivity</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pods_network">Pods Network</h3>
<div class="listingblock">
<div class="title"><strong>1. Exec into the pod</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">CUSTOMER_POD=$(kubectl get pods -n yaobank <span class="hljs-_">-l</span> app=customer -o name)
kubectl <span class="hljs-built_in">exec</span> -ti -n yaobank <span class="hljs-variable">$CUSTOMER_POD</span> -- /bin/bash</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. list interfaces</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">root@customer-574bd6cc75-9wx6m:/app<span class="hljs-comment"># ip a</span>
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
3: eth0@<span class="hljs-keyword">if</span>5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1410 qdisc noqueue state UP group default
    link/ether 86:2d:a8:72:34:7d brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 198.19.22.147/32 brd 198.19.22.147 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::842d:a8ff:fe72:347d/64 scope link
       valid_lft forever preferred_lft forever</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>There is a lo loopback interface with an IP address of 127.0.0.1. This is the standard loopback interface that every network namespace has by default. You can think of it as localhost for the pod itself.</p>
</li>
<li>
<p>There is an eth0 interface which has the pods actual IP address, 198.19.22.147. Notice this matches the IP address that kubectl get pods returned earlier.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><strong>3. ip link</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">root@customer-574bd6cc75-9wx6m:/app<span class="hljs-comment"># ip -c link show up</span>
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
3: eth0@<span class="hljs-keyword">if</span>5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1410 qdisc noqueue state UP mode DEFAULT group default
    link/ether 86:2d:a8:72:34:7d brd ff:ff:ff:ff:ff:ff link-netnsid 0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. Routing Table</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">root@customer-574bd6cc75-9wx6m:/app<span class="hljs-comment"># ip route</span>
default via 169.254.1.1 dev eth0
169.254.1.1 dev eth0  scope link</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This shows that the pod&#x2019;s default route is out over the eth0 interface. i.e. Anytime it wants to send traffic to anywhere other than itself, it will send the traffic over eth0. (Note that the next hop address of 169.254.1.1 is a dummy address used by Calico. Every Calico networked pod sees this as its next hop.)
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><strong>5. Exit from the customer pod</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"><span class="hljs-built_in">exit</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wireguard_encryption">WireGuard Encryption</h3>
<div class="listingblock">
<div class="title"><strong>1. enabling encryption</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">calicoctl patch felixconfiguration default --type=<span class="hljs-string">&apos;merge&apos;</span> -p <span class="hljs-string">&apos;{&quot;spec&quot;:{&quot;wireguardEnabled&quot;:true}}&apos;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. wireguardPublicKey</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ calicoctl get node node1 -o yaml
apiVersion: projectcalico.org/v3
kind: Node
metadata:
  annotations:
    projectcalico.org/kube-labels: <span class="hljs-string">&apos;{&quot;beta.kubernetes.io/arch&quot;:&quot;amd64&quot;,&quot;beta.kubernetes.io/instance-type&quot;:&quot;k3s&quot;,&quot;beta.kubernetes.io/os&quot;:&quot;linux&quot;,&quot;k3s.io/hostname&quot;:&quot;node1&quot;,&quot;k3s.io/internal-ip&quot;:&quot;198.19.0.2&quot;,&quot;kubernetes.io/arch&quot;:&quot;amd64&quot;,&quot;kubernetes.io/hostname&quot;:&quot;node1&quot;,&quot;kubernetes.io/os&quot;:&quot;linux&quot;,&quot;node.kubernetes.io/instance-type&quot;:&quot;k3s&quot;}&apos;</span>
  creationTimestamp: <span class="hljs-string">&quot;2021-08-25T14:20:09Z&quot;</span>
  labels:
    beta.kubernetes.io/arch: amd64
    beta.kubernetes.io/instance-type: k3s
    beta.kubernetes.io/os: linux
    k3s.io/hostname: node1
    k3s.io/internal-ip: 198.19.0.2
    kubernetes.io/arch: amd64
    kubernetes.io/hostname: node1
    kubernetes.io/os: linux
    node.kubernetes.io/instance-type: k3s
  name: node1
  resourceVersion: <span class="hljs-string">&quot;22959&quot;</span>
  uid: 15122ad5-dfd7-4dfe-9c26-7a637a7088be
spec:
  bgp:
    ipv4Address: 198.19.0.2/20
  orchRefs:
  - nodeName: node1
    orchestrator: k8s
  wireguard:
    interfaceIPv4Address: 198.19.22.157
status:
  podCIDRs:
  - 198.19.17.0/24
  wireguardPublicKey: bIuu8myw2pIonLtCqtTf2bmzg4Syswp8m7wKh8C6mT4=</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. inspect wireguard from the interfaces</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ssh node1
$ ip addr | grep wireguard
13: wireguard.cali: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1400 qdisc noqueue state UNKNOWN group default qlen 1000
    inet 198.19.22.157/32 brd 198.19.22.157 scope global wireguard.cali</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. Disabling Encryption</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">calicoctl patch felixconfiguration default --type=<span class="hljs-string">&apos;merge&apos;</span> -p <span class="hljs-string">&apos;{&quot;spec&quot;:{&quot;wireguardEnabled&quot;:false}}&apos;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ip_pools">IP Pools</h3>
<div class="ulist">
<ul>
<li>
<p>IP Pools are calico resource which define ranges of addresses that the calico IP address management and IPAM CNI plugin can use.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ calicoctl get IPPool default-ipv4-ippool -o yaml
apiVersion: projectcalico.org/v3
kind: IPPool
metadata:
  creationTimestamp: <span class="hljs-string">&quot;2021-08-25T14:43:21Z&quot;</span>
  name: default-ipv4-ippool
  resourceVersion: <span class="hljs-string">&quot;1371&quot;</span>
  uid: 218a5773-6fff-48fd<span class="hljs-_">-a</span>175-486b9ad66faa
spec:
  blockSize: 26
  cidr: 198.19.16.0/21
  ipipMode: Never
  natOutgoing: <span class="hljs-literal">true</span>
  nodeSelector: all()
  vxlanMode: Never</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The IP Pool can be per Node, pernamespace</p>
</li>
<li>
<p>To improve performance and scalibility, Calico IPAM to allocates IPs to nodes in blocks.IP &#x5206;&#x914D;&#x662F;&#x52A8;&#x6001;&#x7684;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;NODE&#x7528;&#x5B8C;&#x4E86; 64 &#x4E2A;&#x5730;&#x5740;&#x540E;&#xFF0C;Calico IPAM &#x4F1A;&#x5728;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x65B0; Block&#xFF0C;&#x5982;&#x679C; Block &#x88AB;&#x5206;&#x914D;&#x5B8C;&#x4E86;&#xFF0C;&#x5219;&#x4F1A;&#x5230;&#x76F8;&#x90BB;&#x7684; NODE&#x7684;Block&#x501F;&#x4E00;&#x4E2A;IP&#x3002;</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_bgp_peering">BGP Peering</h3>
<div class="ulist">
<ul>
<li>
<p><strong>&#x4EC0;&#x4E48;&#x662F; BGP</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>BGP &#x662F;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x7684;&#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x7F51;&#x7EDC;&#x8DEF;&#x7531;&#x5668;&#x90FD;&#x652F;&#x6301; BGP &#x534F;&#x8BAE;&#xFF0C;BGP &#x534F;&#x8BAE;&#x7528;&#x6765;&#x5728;&#x8DEF;&#x7531;&#x5668;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x548C;&#x540C;&#x6B65;&#x8DEF;&#x7531;&#x4FE1;&#x606F;&#x3002;</p>
</div>
</div>
<div class="sect2">
<h3 id="_cluster_ip_address_ranges">Cluster IP Address Ranges</h3>
<div class="paragraph">
<p>There are two address ranges that Kubernetes is normally configured with that are worth understanding:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The cluster pod CIDR is the range of IP addresses Kubernetes is expecting to be assigned to pods in the cluster.</p>
</li>
<li>
<p>The services CIDR is the range of IP addresses that are used for the Cluster IPs of Kubernetes Sevices (the virtual IP that corresponds to each Kubernetes Service).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl cluster-info dump | grep -m 2 -E <span class="hljs-string">&quot;service-cidr|cluster-cidr&quot;</span>
                    <span class="hljs-string">&quot;k3s.io/node-args&quot;</span>: <span class="hljs-string">&quot;[\&quot;server\&quot;,\&quot;--flannel-backend\&quot;,\&quot;none\&quot;,\&quot;--cluster-cidr\&quot;,\&quot;198.19.16.0/20\&quot;,\&quot;--service-cidr\&quot;,\&quot;198.19.32.0/20\&quot;,\&quot;--write-kubeconfig-mode\&quot;,\&quot;664\&quot;,\&quot;--disable-network-policy\&quot;]&quot;</span>,</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_ip_pools">Create IP Pools</h3>
<div class="listingblock">
<div class="title"><strong>1. Create externally routable IP Pool</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | calicoctl apply <span class="hljs-_">-f</span> -
---
apiVersion: projectcalico.org/v3
kind: IPPool
metadata:
  name: external-pool
spec:
  cidr: 198.19.24.0/21
  blockSize: 29
  ipipMode: Never
  natOutgoing: <span class="hljs-literal">true</span>
  nodeSelector: <span class="hljs-string">&quot;!all()&quot;</span>
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. Examine BGP peering status</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ssh node1
$ sudo calicoctl node status
Calico process is running.

IPv4 BGP status
+--------------+-------------------+-------+----------+-------------+
| PEER ADDRESS |     PEER TYPE     | STATE |  SINCE   |    INFO     |
+--------------+-------------------+-------+----------+-------------+
| 198.19.0.1   | node-to-node mesh | up    | 07:25:58 | Established |
| 198.19.0.3   | node-to-node mesh | up    | 07:25:56 | Established |
+--------------+-------------------+-------+----------+-------------+

IPv6 BGP status
No IPv6 peers found.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. Add a BGP Peer</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | calicoctl apply <span class="hljs-_">-f</span> -
---
apiVersion: projectcalico.org/v3
kind: BGPPeer
metadata:
  name: bgppeer-global-host1
spec:
  peerIP: 198.19.15.254
  asNumber: 64512
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. Examine BGP peering status</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ssh node1
$ sudo calicoctl node status
Calico process is running.

IPv4 BGP status
+---------------+-------------------+-------+----------+-------------+
| PEER ADDRESS  |     PEER TYPE     | STATE |  SINCE   |    INFO     |
+---------------+-------------------+-------+----------+-------------+
| 198.19.0.1    | node-to-node mesh | up    | 07:25:58 | Established |
| 198.19.0.3    | node-to-node mesh | up    | 07:25:56 | Established |
| 198.19.15.254 | global            | up    | 08:39:33 | Established |
+---------------+-------------------+-------+----------+-------------+

IPv6 BGP status
No IPv6 peers found.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. Configure a Namespace to use External Routable IP Addresses</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF| kubectl apply <span class="hljs-_">-f</span> -
---
apiVersion: v1
kind: Namespace
metadata:
  annotations:
    cni.projectcalico.org/ipv4pools: <span class="hljs-string">&apos;[&quot;external-pool&quot;]&apos;</span>
  name: external-ns
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. Deploy Nginx</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF| kubectl apply <span class="hljs-_">-f</span> -
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
  namespace: external-ns
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
        version: v1
    spec:
      containers:
      - name: nginx
        image: nginx
        imagePullPolicy: IfNotPresent
      nodeSelector:
        kubernetes.io/hostname: node1

---
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: nginx
  namespace: external-ns
spec:
  podSelector:
    matchLabels:
      app: nginx
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - ports:
    - protocol: TCP
      port: 80
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>7. Access the NGINX pod from outside the cluster</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl get pods -n external-ns -o wide --no-headers
nginx-8c44c96c6-xtw74   1/1   Running   0     70s   198.19.28.208   node1   &lt;none&gt;   &lt;none&gt;

$ curl 198.19.28.208 -I
HTTP/1.1 200 OK
Server: nginx/1.21.1
Date: Sat, 28 Aug 2021 08:48:10 GMT
Content-Type: text/html
Content-Length: 612
Last-Modified: Tue, 06 Jul 2021 14:59:17 GMT
Connection: keep-alive
ETag: <span class="hljs-string">&quot;60e46fc5-264&quot;</span>
Accept-Ranges: bytes</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>8. Check Calico IPAM allocations statistics</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ calicoctl ipam show
+----------+----------------+-----------+------------+-------------+
| GROUPING |      CIDR      | IPS TOTAL | IPS IN USE |  IPS FREE   |
+----------+----------------+-----------+------------+-------------+
| IP Pool  | 198.19.16.0/21 |      2048 | 12 (1%)    | 2036 (99%)  |
| IP Pool  | 198.19.24.0/21 |      2048 | 1 (0%)     | 2047 (100%) |
+----------+----------------+-----------+------------+-------------+</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kubernetes_services_networking">Kubernetes Services Networking</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kube_proxy_service_debug">kube-proxy service debug</h3>
<div class="listingblock">
<div class="title"><strong>1. List the services</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl get svc -n yaobank
NAME       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
database   ClusterIP   198.19.33.67    &lt;none&gt;        2379/TCP       2d23h
summary    ClusterIP   198.19.46.158   &lt;none&gt;        80/TCP         2d23h
customer   NodePort    198.19.32.122   &lt;none&gt;        80:30180/TCP   2d23h</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. List the endpoints for each of the services</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl get endpoints -n yaobank
NAME       ENDPOINTS                       AGE
customer   198.19.22.156:80                2d23h
database   198.19.21.74:2379               2d23h
summary    198.19.21.7:80,198.19.21.8:80   2d23h</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. List the pods</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl get pods -n yaobank -o wide --no-headers
database-6c5db58d95-nnwsp   1/1   Running   2     2d23h   198.19.21.74    node2     &lt;none&gt;   &lt;none&gt;
summary-85c56b76d7-v8vs6    1/1   Running   2     2d23h   198.19.21.7     control   &lt;none&gt;   &lt;none&gt;
summary-85c56b76d7-nn9fv    1/1   Running   2     2d23h   198.19.21.8     control   &lt;none&gt;   &lt;none&gt;
customer-574bd6cc75-9wx6m   1/1   Running   2     2d23h   198.19.22.156   node1     &lt;none&gt;   &lt;none&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_clusterip">ClusterIP</h4>
<div class="paragraph">
<p><span class="image"><img src="files/Cluster_IP_Diagram.png" alt="Cluster IP Diagram.png"></span></p>
</div>
<div class="listingblock">
<div class="title"><strong>1. KUBE-SERVICES &#x2192; KUBE-SVC-XXXXXXXXXXXXXXXX</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ssh control
$ sudo iptables -v --numeric --table nat --list KUBE-SERVICES | grep  summary
    0     0 KUBE-MARK-MASQ  tcp  --  *      *      !198.19.16.0/20       198.19.46.158        /* yaobank/summary:http cluster IP */ tcp dpt:80
    0     0 KUBE-SVC-OIQIZJVJK6E34BR4  tcp  --  *      *       0.0.0.0/0            198.19.46.158        /* yaobank/summary:http cluster IP */ tcp dpt:80</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. KUBE-SVC-OIQIZJVJK6E34BR4 &#x2192; KUBE-SEP-XXXXXXXXXXXXXXXX</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo iptables -v --numeric --table nat --list KUBE-SVC-OIQIZJVJK6E34BR4
Chain KUBE-SVC-OIQIZJVJK6E34BR4 (1 references)
 pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination
    0     0 KUBE-SEP-GRMQA4KZODSYCGHU  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* yaobank/summary:http */ statistic mode random probability 0.50000000000
    0     0 KUBE-SEP-HE4BCN24RMUDWA6V  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* yaobank/summary:http */</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. KUBE-SEP-XXXXXXXXXXXXXXXX &#x2192; summary endpoint</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo iptables -v --numeric --table nat --list KUBE-SEP-GRMQA4KZODSYCGHU
Chain KUBE-SEP-GRMQA4KZODSYCGHU (1 references)
 pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination
    0     0 KUBE-MARK-MASQ  all  --  *      *       198.19.21.7          0.0.0.0/0            /* yaobank/summary:http */
    0     0 DNAT       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            /* yaobank/summary:http */ tcp to:198.19.21.7:80</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nodeport">NodePort</h4>
<div class="paragraph">
<p><span class="image"><img src="files/NodePorrt_Diagram.png " alt="NodePorrt Diagram.png "></span></p>
</div>
<div class="listingblock">
<div class="title"><strong>1. KUBE-SERVICES &#x2192; KUBE-NODEPORTS</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo iptables -v --numeric --table nat --list KUBE-SERVICES | grep KUBE-NODEPORTS
  619 37158 KUBE-NODEPORTS  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* kubernetes service nodeports; NOTE: this must be the last rule <span class="hljs-keyword">in</span> this chain */ ADDRTYPE match dst-type LOCAL</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. KUBE-NODEPORTS &#x2192; KUBE-SVC-XXXXXXXXXXXXXXXX</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo iptables -v --numeric --table nat --list KUBE-NODEPORTS | grep customer
    0     0 KUBE-MARK-MASQ  tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            /* yaobank/customer:http */ tcp dpt:30180
    0     0 KUBE-SVC-PX5FENG4GZJTCELT  tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            /* yaobank/customer:http */ tcp dpt:30180</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. KUBE-SVC-XXXXXXXXXXXXXXXX &#x2192; KUBE-SEP-XXXXXXXXXXXXXXXX</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo iptables -v --numeric --table nat --list KUBE-SVC-PX5FENG4GZJTCELT
Chain KUBE-SVC-PX5FENG4GZJTCELT (2 references)
 pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination
    0     0 KUBE-SEP-5S2QR7W7CXIFMZTT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* yaobank/customer:http */</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. KUBE-SEP-XXXXXXXXXXXXXXXX &#x2192; customer endpoint</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo iptables -v --numeric --table nat --list KUBE-SEP-5S2QR7W7CXIFMZTT
Chain KUBE-SEP-5S2QR7W7CXIFMZTT (1 references)
 pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination
    0     0 KUBE-MARK-MASQ  all  --  *      *       198.19.22.156        0.0.0.0/0            /* yaobank/customer:http */
    0     0 DNAT       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            /* yaobank/customer:http */ tcp to:198.19.22.156:80</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nodeport_snat">NodePort SNAT</h4>
<div class="listingblock">
<div class="title"><strong>1, Access the customer service via nodeport</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl 198.19.0.1:30180
$ curl 198.19.0.2:30180
$ curl 198.19.0.3:30180</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. View the customer pod logs</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ kubectl logs  customer-574bd6cc75-9wx6m -n yaobank
198.19.0.1 - - [28/Aug/2021 15:14:21] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 -
198.19.0.2 - - [28/Aug/2021 15:16:54] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 -
198.19.0.3 - - [28/Aug/2021 15:17:03] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 -</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_calico_native_service_handling">Calico Native Service Handling</h3>
<div class="ulist">
<ul>
<li>
<p>Calico eBPF data plane supports native service handling.</p>
</li>
<li>
<p>Calico&#x2019;s eBPF dataplane is an alternative to the default standard Linux dataplane (which is iptables based). The eBPF dataplane has a number of advantages:</p>
<div class="ulist">
<ul>
<li>
<p>It scales to higher throughput.</p>
</li>
<li>
<p>It uses less CPU per GBit.</p>
</li>
<li>
<p>It has native support for Kubernetes services (without needing kube-proxy) that:</p>
<div class="ulist">
<ul>
<li>
<p>Reduces first packet latency for packets to services.</p>
</li>
<li>
<p>Preserves external client source IP addresses all the way to the pod.</p>
</li>
<li>
<p>Supports DSR (Direct Server Return) for more efficient service routing.</p>
</li>
<li>
<p>Uses less CPU than kube-proxy to keep the dataplane in sync.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><strong>1. Configure Calico to connect directly to the API server</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | kubectl apply <span class="hljs-_">-f</span> -
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: kubernetes-services-endpoint
  namespace: tigera-operator
data:
  KUBERNETES_SERVICE_HOST: <span class="hljs-string">&quot;198.19.0.1&quot;</span>
  KUBERNETES_SERVICE_PORT: <span class="hljs-string">&quot;6443&quot;</span>
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2.  recreated with the new configuration</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl delete pod -n tigera-operator <span class="hljs-_">-l</span> k8s-app=tigera-operator</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. Disable kube-proxy</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">calicoctl patch felixconfiguration default --patch=<span class="hljs-string">&apos;{&quot;spec&quot;: {&quot;bpfKubeProxyIptablesCleanupEnabled&quot;: false}}&apos;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. Switch on eBPF mode</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">calicoctl patch felixconfiguration default --patch=<span class="hljs-string">&apos;{&quot;spec&quot;: {&quot;bpfEnabled&quot;: true}}&apos;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. restart YAO Bank&#x2019;s customer and summary pods</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl delete pod -n yaobank <span class="hljs-_">-l</span> app=customer
kubectl delete pod -n yaobank <span class="hljs-_">-l</span> app=summary</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_source_ip_preservation">Source IP preservation</h4>
<div class="paragraph">
<p><span class="image"><img src="files/eBPF_Source_IP_Diagram.png" alt="eBPF Source IP Diagram.png"></span></p>
</div>
<div class="listingblock">
<div class="title"><strong>1, Access the customer service via nodeport</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl 198.19.0.1:30180
$ curl 198.19.0.2:30180
$ curl 198.19.0.3:30180</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advertising_services">Advertising Services</h3>
<div class="listingblock">
<div class="title"><strong>1. Update Calico BGP configuration</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF | calicoctl apply <span class="hljs-_">-f</span> -
---
apiVersion: projectcalico.org/v3
kind: BGPConfiguration
metadata:
  name: default
spec:
  serviceClusterIPs:
  - cidr: <span class="hljs-string">&quot;198.19.32.0/20&quot;</span>
EOF</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kubernetes_networking_with_aws">Kubernetes Networking with AWS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_aws_networking">AWS Networking</h3>
<div class="paragraph">
<p><span class="image"><img src="files/aws-global-cloud.png" alt="aws global cloud.png"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AWS Global Cloud</strong> - Devices and Services in many regions.</p>
</li>
<li>
<p><strong>AWS Region</strong> - A physical location around the world where Amazon have equipment in data centers .</p>
</li>
<li>
<p><strong>Virtual Private Cloud(VPC)</strong> - A logically isolated virtual private network that exists within AWS cloud. VPC can span AZ in a region.</p>
</li>
<li>
<p><strong>Availability Zone(AZ)</strong> - A group of data centers in a region, each AZ has independent power, cooling, and physical security and is connected via multiple physical networks.</p>
</li>
<li>
<p><strong>Subnet</strong> - A subnet is a section of VPC&#x2019;s IP range, a subnet must be reside within a single AZ,</p>
</li>
<li>
<p><strong>Elastic Network Interfaces(ENI)</strong> - A logical networking component in a VPC that represents a virtual network card.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_aws_cni">AWS-CNI &#x4F18;&#x7F3A;&#x70B9;</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">&#x4F18;&#x70B9;</th>
<th class="tableblock halign-left valign-top">&#x7F3A;&#x70B9;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Pods get native IPs</p>
</li>
<li>
<p>Routing from outside or control nodes &quot;just works&quot;</p>
</li>
<li>
<p>Using multiple ENIS gives access to more bandwidth</p>
</li>
<li>
<p>IAM integration is improved</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Number of pods per node is limited by number of ENIs and Node type</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_kops">KOps</h3>
<div class="ulist">
<ul>
<li>
<p>Like kubectl for clusters</p>
</li>
<li>
<p>Strengths</p>
<div class="ulist">
<ul>
<li>
<p>Builds production-grade clusters</p>
</li>
<li>
<p>Builds highly available cluster</p>
</li>
<li>
<p>Also provisions the necessary cloud infrastructure</p>
</li>
<li>
<p>Access to all of the Calico&#x2019;s feature</p>
</li>
<li>
<p>AWS is offically support</p>
</li>
<li>
<p>idempotent</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><strong>1. KOps Create Cluster</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kops create cluster --zones ap-northeast-1a,ap-northeast-1c --networking calico --name <span class="hljs-variable">${CLUSTER_NAME}</span>
kops update cluster --name <span class="hljs-variable">${CLUSTER_NAME}</span> --yes --admin</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. KOps Get Cluster</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kops get cluster</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_todo">TODO</h3>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">**</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"></code></pre>
</div>
</div>
</div>
</div>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="flannel.html" class="navigation navigation-prev " aria-label="Previous page: Flannel">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../sdn/" class="navigation navigation-next " aria-label="Next page: SDN">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Calico","level":"1.3.2.3","depth":3,"next":{"title":"SDN","level":"1.4","depth":1,"path":"sdn/README.adoc","ref":"sdn/README.adoc","articles":[{"title":"Mininet","level":"1.4.1","depth":2,"path":"sdn/mininet.adoc","ref":"sdn/mininet.adoc","articles":[]}]},"previous":{"title":"Flannel","level":"1.3.2.2","depth":3,"path":"k8s-net/flannel.adoc","ref":"k8s-net/flannel.adoc","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{"copyrightYear":"2019","copyrightHolder":"Kylin Soong"},"plugins":["collapsible-menu","-sharing","sharing-plus","splitter","back-to-top-button","edit-link"],"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy Kylin Soong 2019","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"collapsible-menu":{},"splitter":{},"search":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"donate":{"wechat":"http://ksoong.org/docs/content/images/wechat.png","alipay":"http://ksoong.org/docs/content/images/alipay.png","title":"","button":"赞赏","alipayText":"支付宝捐赠","wechatText":"微信捐赠"},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"back-to-top-button":{},"sharing":{"weibo":true,"linkedin":true,"google":true,"facebook":true,"all":["facebook","google","linkedin","weibo"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/kylinsoong/docs/blob/gh-pages"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css"}},"file":{"path":"k8s-net/Calico.adoc","mtime":"2021-09-26T01:14:13.658Z","type":"asciidoc"},"gitbook":{"version":"3.2.3","time":"2021-10-24T08:40:49.723Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

