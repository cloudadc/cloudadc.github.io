= 分布式系统
:toc: manual

== 怎样选择一个 Shard Key 

Shard Key 决定如何将一个集合中的文档分发到不同的分片，Shard Key 需要是一个索引的字段或索引的复合字段。将一个集合进行分片语法如下:

[source, bash]
----
sh.shardCollection( <database>.<collection>, <key> )
----

NOTE: 如果集合不为空，那么进行分区操作前，首先必须对 Shard Key 对应的字段创建索引，如果集合为空，那么进行分区操作时会自动创建对 Shard Key 对应的字段创建索引。

到目前可以看出，Shard Key 在集合分区中起到决定性的作用，如何确保集合分区合理高效，就必须选择最合适的 Shard Key。那么如何选择 Shard Key？选择 Shard Key 有三个指标：

* 合理的基数(Cardinality) - 基数不能太小，如果太小，例如 Shard Key 就有三个可能的值，那么如果有超过 3 个分区，则是无意义的，基数太大也不行，虽然可以保证水平扩展，但无法高效的通过 chunk 分发
* 合理的频率(Frequency) - 如果数据集中在某一个 Shard Key 对应的值上，那么数据无法很好的分发
* 合理的变化（Monotonically）- 如果 Shard Key 对应的值在不停的增加或减小，那么靠近 maxKey 或 minKey 的 分区数据变得越来越多，不利于集群高效运行.

[source, bash]
----

----

[source, bash]
----

----

[source, bash]
----

----

